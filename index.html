{% extends "base.html" %}

{% block title %}Welcome to S&P 500 Dashboard{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.plot.ly/plotly-2.25.2.min.js"></script>
{% endblock %}

{% block content %}
<h1>Welcome to the S&P 500 Dashboard</h1>
<p>The website aims to develop an Interactive Stock Market Visualization Tool to help users analyze historical stock market performance for the S&P 500 through a dynamic dashboard. 
    The site features historical stock data with interactive visualizations, such as time-series charts, comparative performance analysis, and a sector-based heatmap.</p>
<h2>What is the S&P 500?</h2>
<p>The S&P 500, or Standard & Poor's 500 Index, is one of the most prominent stock market indices, tracking the performance of approximately 500 of the largest publicly traded companies in the United States. 
    It is widely regarded as a benchmark for the overall U.S. stock market and economy due to its broad representation across all major sectors, including technology, healthcare, and finance.</p>

<div class="chart-container">
    <h2>Annual Return Bar Chart (S&P 500)</h2>
    <canvas id="barChart"></canvas>
</div>

<div class="chart-container">
    <h2>S&P 500 Candlestick Chart</h2>
    <div id="chart" style="width: 100%; max-width: 800px; height: 600px;"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Bar Chart
    fetch('/api/annual_returns_data')
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                console.error(data.error);
                alert("An error occurred: " + data.error);
            } else {
                const labels = data.labels;
                const returns = data.returns;

                const annualReturnsData = {
                    labels: labels,
                    datasets: [{
                        label: 'Annual Return (%)',
                        data: returns,
                        backgroundColor: returns.map(value => value < 0 ? 'rgba(255, 99, 132, 0.5)' : 'rgba(75, 192, 192, 0.5)'),
                        borderColor: returns.map(value => value < 0 ? 'rgba(255, 99, 132, 1)' : 'rgba(75, 192, 192, 1)'),
                        borderWidth: 1
                    }]
                };

                const barChartOptions = {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Year'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Annual Return (%)'
                            },
                            beginAtZero: true
                        }
                    },
                };

                const ctx = document.getElementById('barChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: annualReturnsData,
                    options: barChartOptions
                });
            }
        })
        .catch(error => {
            console.error("Error fetching data:", error);
            alert("A network error occurred.");
        });

    // Candlestick Chart (using your original sample data)
    const data = [
        { date: '2025-01-01', open: 5868.55, high: 6118.71, low: 5827.04, close: 6101.24 },
        { date: '2024-01-01', open: 4742.83, high: 6090.27, low: 4688.68, close: 5881.63 },
        { date: '2023-01-01', open: 3824.14, high: 4783.35, low: 3808.1, close: 4769.83 },
        { date: '2022-01-01', open: 4796.56, high: 4796.56, low: 3577.03, close: 3839.5 },
        { date: '2021-01-01', open: 3700.65, high: 4793.06, low: 3700.65, close: 4766.18 },
        { date: '2020-01-01', open: 3257.85, high: 3756.07, low: 2237.4, close: 3756.07 },
        { date: '2019-01-01', open: 2510.03, high: 3240.02, low: 2447.89, close: 3230.78 },
        { date: '2018-01-01', open: 2695.81, high: 2930.75, low: 2351.1, close: 2506.85 },
        { date: '2017-01-01', open: 2257.83, high: 2690.16, low: 2257.83, close: 2673.61 },
        { date: '2016-01-01', open: 2012.66, high: 2271.72, low: 1829.08, close: 2238.83 },
        { date: '2015-01-01', open: 2058.2, high: 2130.82, low: 1867.61, close: 2043.94 },
        { date: '2014-01-01', open: 1831.98, high: 2090.57, low: 1741.89, close: 2058.9 },
        { date: '2013-01-01', open: 1462.42, high: 1848.36, low: 1457.15, close: 1848.36 },
        { date: '2012-01-01', open: 1277.06, high: 1465.77, low: 1277.06, close: 1426.19 },
        { date: '2011-01-01', open: 1271.87, high: 1363.61, low: 1099.23, close: 1257.6 },
        { date: '2010-01-01', open: 1132.99, high: 1259.78, low: 1022.58, close: 1257.64 },
        { date: '2009-01-01', open: 931.8, high: 1127.78, low: 676.53, close: 1115.1 },
        { date: '2008-01-01', open: 1447.16, high: 1447.16, low: 752.44, close: 903.25 },
        { date: '2007-01-01', open: 1416.6, high: 1565.15, low: 1374.12, close: 1468.36 },
        { date: '2006-01-01', open: 1268.8, high: 1427.09, low: 1223.69, close: 1418.3 },
        { date: '2005-01-01', open: 1202.08, high: 1272.74, low: 1137.5, close: 1248.29 },
        { date: '2004-01-01', open: 1108.48, high: 1213.55, low: 1063.23, close: 1211.92 },
        { date: '2003-01-01', open: 909.03, high: 1111.92, low: 800.73, close: 1111.92 },
        { date: '2002-01-01', open: 1154.67, high: 1172.51, low: 776.76, close: 879.82 },
        { date: '2001-01-01', open: 1283.27, high: 1373.73, low: 965.8, close: 1148.08 },
        { date: '2000-01-01', open: 1455.22, high: 1527.46, low: 1264.74, close: 1320.28 },
        { date: '1999-01-01', open: 1228.1, high: 1469.25, low: 1212.19, close: 1469.25 },
        { date: '1998-01-01', open: 975.04, high: 1241.81, low: 927.69, close: 1229.23 },
        { date: '1997-01-01', open: 737.01, high: 983.79, low: 737.01, close: 970.43 },
        { date: '1996-01-01', open: 620.73, high: 757.03, low: 598.48, close: 740.74 },
        { date: '1995-01-01', open: 459.11, high: 621.69, low: 459.11, close: 615.93 },
        { date: '1994-01-01', open: 465.44, high: 482, low: 438.92, close: 459.27 },
        { date: '1993-01-01', open: 435.38, high: 470.94, low: 429.05, close: 466.45 },
        { date: '1992-01-01', open: 417.26, high: 441.28, low: 394.5, close: 435.71 },
        { date: '1991-01-01', open: 326.45, high: 417.09, low: 311.49, close: 417.09 },
        { date: '1990-01-01', open: 359.69, high: 368.95, low: 295.46, close: 330.22 },
        { date: '1989-01-01', open: 275.31, high: 359.8, low: 275.31, close: 353.4 },
        { date: '1988-01-01', open: 255.94, high: 283.66, low: 242.63, close: 277.72 },
        { date: '1987-01-01', open: 246.45, high: 336.77, low: 223.92, close: 247.08 },
        { date: '1986-01-01', open: 209.59, high: 254, low: 203.49, close: 242.17 },
        { date: '1985-01-01', open: 165.37, high: 212.02, low: 163.68, close: 211.28 },
        { date: '1984-01-01', open: 164.04, high: 170.41, low: 147.82, close: 167.24 },
        { date: '1983-01-01', open: 138.34, high: 172.65, low: 138.34, close: 164.93 },
        { date: '1982-01-01', open: 122.74, high: 143.02, low: 102.42, close: 140.64 },
        { date: '1981-01-01', open: 136.34, high: 138.12, low: 112.77, close: 122.55 },
        { date: '1980-01-01', open: 105.76, high: 140.52, low: 98.22, close: 135.76 },
        { date: '1979-01-01', open: 96.73, high: 111.27, low: 96.13, close: 107.94 },
        { date: '1978-01-01', open: 93.82, high: 106.99, low: 86.9, close: 96.11 },
        { date: '1977-01-01', open: 107, high: 107, low: 90.71, close: 95.1 },
        { date: '1976-01-01', open: 90.9, high: 107.83, low: 90.9, close: 107.46 },
        { date: '1975-01-01', open: 70.23, high: 95.61, low: 70.04, close: 90.19 },
        { date: '1974-01-01', open: 97.68, high: 99.8, low: 62.28, close: 68.56 },
        { date: '1973-01-01', open: 119.1, high: 120.24, low: 92.16, close: 97.55 },
        { date: '1972-01-01', open: 101.67, high: 119.12, low: 101.67, close: 118.05 },
        { date: '1971-01-01', open: 91.15, high: 104.77, low: 90.16, close: 102.09 },
        { date: '1970-01-01', open: 93, high: 93.46, low: 69.29, close: 92.15 },
        { date: '1969-01-01', open: 103.93, high: 106.16, low: 89.2, close: 92.06 },
        { date: '1968-01-01', open: 96.11, high: 108.37, low: 87.72, close: 103.86 },
        { date: '1967-01-01', open: 80.38, high: 97.59, low: 80.38, close: 96.47 },
        { date: '1966-01-01', open: 92.18, high: 94.06, low: 73.2, close: 80.33 },
        { date: '1965-01-01', open: 84.23, high: 92.63, low: 81.6, close: 92.43 },
        { date: '1964-01-01', open: 75.43, high: 86.28, low: 75.43, close: 84.75 },
        { date: '1963-01-01', open: 62.69, high: 75.02, low: 62.69, close: 75.02 },
        { date: '1962-01-01', open: 70.96, high: 71.13, low: 52.32, close: 63.1 },
        { date: '1961-01-01', open: 57.57, high: 72.64, low: 57.57, close: 71.55 },
        { date: '1960-01-01', open: 59.91, high: 60.39, low: 52.2, close: 58.11 },
        { date: '1959-01-01', open: 55.44, high: 60.71, low: 53.58, close: 59.89 },
        { date: '1958-01-01', open: 40.33, high: 55.21, low: 40.33, close: 55.21 },
        { date: '1957-01-01', open: 46.2, high: 49.13, low: 38.98, close: 39.99 },
        { date: '1956-01-01', open: 45.16, high: 49.64, low: 43.11, close: 46.67 },
        { date: '1955-01-01', open: 36.75, high: 46.41, low: 34.58, close: 45.48 },
        { date: '1954-01-01', open: 24.95, high: 35.98, low: 24.8, close: 35.98 },
        { date: '1953-01-01', open: 26.54, high: 26.66, low: 22.71, close: 24.81 },
        { date: '1952-01-01', open: 23.8, high: 26.59, low: 23.09, close: 26.57 },
        { date: '1951-01-01', open: 20.77, high: 23.85, low: 20.69, close: 23.77 },
        { date: '1950-01-01', open: 16.66, high: 20.43, low: 16.65, close: 20.41 },
        { date: '1949-01-01', open: 14.95, high: 16.79, low: 13.55, close: 16.76 },
        { date: '1948-01-01', open: 15.34, high: 17.06, low: 13.84, close: 15.2 },
        { date: '1947-01-01', open: 15.2, high: 16.2, low: 13.71, close: 15.3 },
        { date: '1946-01-01', open: 17.25, high: 19.25, low: 14.12, close: 15.3 },
        { date: '1945-01-01', open: 13.33, high: 17.68, low: 13.21, close: 17.36 },
        { date: '1944-01-01', open: 11.66, high: 13.29, low: 11.56, close: 13.28 },
        { date: '1943-01-01', open: 9.84, high: 12.64, low: 9.84, close: 11.67 },
        { date: '1942-01-01', open: 8.89, high: 9.77, low: 7.47, close: 9.77 },
        { date: '1941-01-01', open: 10.48, high: 10.86, low: 8.37, close: 8.69 },
        { date: '1940-01-01', open: 12.63, high: 12.77, low: 8.99, close: 10.58 },
        { date: '1939-01-01', open: 13.08, high: 13.23, low: 10.18, close: 12.49 },
        { date: '1938-01-01', open: 10.52, high: 13.91, low: 8.5, close: 13.21 },
        { date: '1937-01-01', open: 17.02, high: 18.68, low: 10.17, close: 10.55 },
        { date: '1936-01-01', open: 13.4, high: 17.69, low: 13.4, close: 17.18 },
        { date: '1935-01-01', open: 9.51, high: 13.46, low: 8.06, close: 13.43 },
        { date: '1934-01-01', open: 10.11, high: 11.82, low: 8.36, close: 9.5 },
        { date: '1933-01-01', open: 6.83, high: 12.2, low: 5.53, close: 10.1 },
        { date: '1932-01-01', open: 7.82, high: 9.31, low: 4.4, close: 6.89 },
        { date: '1931-01-01', open: 15.85, high: 18.17, low: 7.72, close: 8.12 },
        { date: '1930-01-01', open: 21.18, high: 25.92, low: 14.44, close: 15.34 },
        { date: '1929-01-01', open: 24.81, high: 31.86, low: 17.66, close: 21.45 },
        { date: '1928-01-01', open: 17.76, high: 24.35, low: 16.95, close: 24.35 }
    ];

    const dates = data.map(d => d.date);
    const open = data.map(d => d.open);
    const high = data.map(d => d.high);
    const low = data.map(d => d.low);
    const close = data.map(d => d.close);

    const trace = {
        x: dates,
        close: close,
        high: high,
        low: low,
        open: open,
        type: 'candlestick',
        xaxis: 'x',
        yaxis: 'y'
    };

    const layout = {
        title: 'Candlestick Chart (2010-2025)',
        xaxis: { title: 'Year' },
        yaxis: { title: 'Price' }
    };

    Plotly.newPlot('chart', [trace], layout);
</script>

{% endblock %}